
# Call Data Service

Микросервис для генерации CDR-записей, их сохранения в базу данных и предоставления REST API для получения UDR-отчетов.

## Описание

Микросервис эмулирует работу коммутатора, генерируя CDR-записи, сохраняя их в локальную базу данных H2 и предоставляя REST API для получения UDR-отчетов. 
CDR-записи содержат информацию о звонках абонентов, а UDR-отчеты предоставляют сводную информацию о длительности звонков для каждого абонента.

## Запуск приложения

1. **Клонирование репозитория:**

   ```bash
   git clone https://github.com/abarigena/Call-Data-Service
   ```

2. **Сборка и запуск приложения:**

   ```bash
   mvn clean install
   mvn spring-boot:run
   ```

   Либо можно скачать готовый JAR-файл из [релизов](https://github.com/abarigena/Call-Data-Service/releases/tag/v0.0.1) и запустить его:

   ```bash
   java -jar call-data-service.jar
   ```

3. **Документация API:**

   После запуска приложения, документация API доступна по адресу:

   [http://localhost:8000/swagger-ui/index.html](http://localhost:8000/swagger-ui/index.html)

4. **Работа с базой данных H2:**

   Для просмотра и управления базой данных H2, перейдите по адресу:

   [http://localhost:8000/h2-console](http://localhost:8000/h2-console)

    - **URL JDBC:** `jdbc:h2:file:./data/cdr_db`
    - **Username:** `username`
    - **Password:** `password`

    Чтобы посмотреть всех существующих абонентов, выполните SQL-запрос в консоли H2:
    ```sql
    SELECT * FROM SUBSCRIBERS;
    ```

## REST API

### Генерация CDR-записей

- **Эндпоинт:** `POST /api/cdr/generate`
- **Описание:** Инициирует генерацию CDR-записей за весь год.

### Получение UDR-отчета для одного абонента

- **Эндпоинт:** `GET /api/udr/subscriber/{msisdn}`
- **Параметры:**
    - `msisdn` - номер абонента.
    - `year` (опционально).
    - `month` (опционально).

### Получение UDR-отчетов для всех абонентов за месяц

- **Эндпоинт:** `GET /api/udr/subscribers`
- **Параметры:**
    - `year` - год.
    - `month` - месяц.

### Генерация CDR-отчета

- **Эндпоинт:** `POST /api/cdr/reports/generate`
- **Описание:** Генерирует CDR-отчет для указанного абонента за заданный период. Отчет сохраняется в папку `reports` в формате CSV.
- **Пример тела запроса:**

  ```json
  {
    "msisdn": "79990000010",
    "startDate": "2025-01-01T00:00:00",
    "endDate": "2025-01-31T23:59:59"
  }

### Упрощенная генерация CDR-отчета

- **Эндпоинт:** `POST /api/cdr/reports/generate-simple`
- **Описание:** Генерирует CDR-отчет для указанного абонента за последние N дней. Отчет сохраняется в папку `reports` в формате CSV.
- **Пример тела запроса:**

  ```json
  {
    "msisdn": "79990000010",
    "periodInDays": 14
  }

